# 데드락 (DeadLock)

### 🚌 데드락 (DeadLock, 교착상태)

두 개 이상의 프로세스나 스레드가 서로 자원을 얻지 못해서 다음 처리를 하지 못하는 상태이다. 시스템에서 한정된 자원을 여러 곳에서 사용하려고 할 때, 교착상태가 발생한다.

</br>

</br>

![img](데드락 (DeadLock).assets/img.png)

프로세스 1과 프로세스 2가 자원 1, 2를 모두 얻어야 할 때, 

- 프로세스 1이 자원 1을 사용 / 프로세스 2가 자원 2를 사용
- 프로세스 1이 자원 2를 기다림 / 프로세스 2가 자원 1을 기다림

현재 서로 원하는 자원을 다른 프로세스가 사용하고 있으므로 무한 대기 상태에 빠지게 되는데, 이것을 **데드락**이라고 한다.

</br>

</br>

### 발생 조건

아래 네 가지 조건 중 하나라도 성립하지 않으면 데드락은 발생하지 않는다.

- 상호 배제 (Mutual exclusion) : 자원은 한 번에 하나의 프로세스만 사용할 수 있다.

- 점유 대기 (Hold and wait) : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재해야 한다.

  > 자원을 가지고 있는 상태에서 다른 프로세스가 점유 중인 자원을 기다리는 상태

- 비선점 (No preemption) : 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없다.

- 순환 대기 (Circular wait) : 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 한다.

  > 프로세스 0은 프로세스 1이 점유한 자원을 대기하고, 프로세스 1은 프로세스 2가 점유한 자원을 대기하고, 프로세스 n은 프로세스 0이 점유한 자원을 요구해야 한다.

</br>

</br>

### 처리 방법

**예방 (Prevention)** : 교착 상태 발생 조건 중 하나를 제거하면서 해결한다. (자원 낭비 심함)

- 상호배제 부정 : 여러 프로세스가 공유 자원 사용

- 점유대기 부정 : 프로세스 실행 전 모든 자원을 할당

  > 프로세스가 실행되기 전에 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나, 자원이 점유되지 않은 상태에서만 자원 요청을 받도록 하는 것이다.

- 비선점 부정 : 자원 점유 중인 프로세스가 다른 자원을 요구할 때, 가지고 있는 자원을 반납

- 순환대기 부정 : 자원에 고유번호 할당 후 순서대로 자원 요구

**회피 (avoidance)** : 교착 상태 발생 시 피하는 방법이다.

- 은행원 알고리즘 : 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래한다. 프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있는지 검사하여 교착 상태를 회피하는 것이다. 안정 상태라면 자원을 할당하고, 아니면 다른 프로세스들이 자원을 해지할 때까지 대기한다.

**탐지 (Detection)** : 자원 할당 그래프를 통해 교착 상태를 탐지한다. 자원 요청 시, 탐지 알고리즘을 실행시키므로 오버헤드가 발생할 수 있다.

**회복 (Recovery)** : 교착 상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제시켜서 회복시키는 방법이다.

- 프로세스 종료 방법 : 교착 상태의 프로세스를 모두 중지하거나 교착 상태가 제거될 때까지 하나씩 프로세스를 중지한다.
- 자원 선점 방법 : 교착 상태의 프로세스가 점유하고 있는 자원을 선점하여 다른 프로세스에게 할당하거나 우선 순위가 낮은 프로세스나 수행 횟수가 적은 프로세스 위주로 프로세스를 자원 선점할 수 있도록 하는 것이다.