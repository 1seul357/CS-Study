# CPU 스케줄링

### 스케줄링

작업을 처리하기 위해서 프로세스들에게 CPU를 할당하기 위한 정책을 계획하는 것이다. CPU를 효율적으로 사용하기 위해서는 프로세스들 잘 배정해야 한다. 이러한 스케줄링을 평가할 수 있는 기준으로는 약 5가지가 있다.

- CPU Utilization : 전체 시스템 시간 중 CPU가 작업을 처리하는 시간의 비율
- Throughput : CPU가 단위 시간당 처리하는 프로세스의 갯수
- Response Time : 프로세스가 입출력을 시작해서 첫 결과가 나오는데 걸리는 시간
- Waiting Time : 프로세스가 Ready Queue에서 대기하는 시간의 총합
- Turnaround Time : 프로세스가 시작해서 끝날 때 까지 걸리는 시간

</br>

</br>

### CPU 스케줄링 방식

#### 선점

OS가 CPU 사용권을 선점할 수 있는 경우에 강제로 회수할 수 있다. 우선순위가 높은 프로세스들이 CPU를 점유하게 된다.

**장점**

- 높은 우선 순위를 가진 프로세스를 빠르게 처리하려는 시스템에 유용하다.
- 각 프로세스의 대기시간이 적다.

**단점**

- 높은 우선 순위를 가진 프로세스들만 들어오는 경우 Context Switch가 자주 발생하여 오버헤드가 발생한다.

</br>

#### 비선점

프로세스 종료 또는 입출력 등의 이벤트가 있으면 실행을 보장한다. 우선순위에 따라 Ready Queue 내에서 프로세스의 위치가 달라질 수 있다.

**장점**

- 모든 프로세스들에게 공정하다.
- 응답 시간을 예측할 수 있다.

**단점**

- 짧은 작업을 수행하는 프로세스라도 긴 작업이 종료될 때까지 기다려야 한다.

</br>

</br>

### CPU 스케줄링 종류

#### FCFS (First Come First Served)

비선점 스케줄링. Queue에 도착한 순서대로 CPU를 할당한다. 우선순위가 없으며 프로세스가 Ready Queue에 들어오면 가장 앞에 있는 PCB를 가져와서 프로세스를 실행한다. 단순 반복 작업에 유리하고, 평균 대기시간이 길다.

| Process | Burst Time |
| :-----: | :--------: |
|   P1    |     24     |
|   P2    |     3      |
|   P3    |     3      |

(1) P1, P2, P3 순서로 요청하였을 때의 대기시간

대기시간 : P1 = 0, P2 = 24, P3 = 27

평균 대기시간 : (0+24+27) / 3 = 17

(2) P2, P3, P1 순서로 요청하였을 때의 대기시간

대기시간 : P1 = 6, P2 = 0, P3 = 3

평균 대기시간 : (6+0+3) / 3 = 3

</br>

#### SJF (Shortest Job First)

선점 & 비선점 스케줄링. 수행시간이 가장 짧은 작업부터 먼저 수행하는 것이다. FCFS보다 평균 대기시간이 짧다.  

- 선점 스케줄링 : 현재 실행 중인 프로세스의 남은 CPU 수행시간이 새로 들어온 프로세스보다 긴 경우에 현재 프로세스를 중단한다. 그리고 Context Switch를 통해 새로 들어온 프로세스를 먼저 실행한다.
- 비선점 스케줄링 : CPU 수행시간이 짧은 순서대로 Reqdy Queue에 연결되고, 실행된다.

</br>

#### HRN (Hightest Response-ratio Next)

비선점 스케줄링. 프로세스 처리의 우선순위를 CPU 수행시간과 대기시간을 함께 고려하여 선정하는 스케줄링 알고리즘이다. 점유 불평등을 보완할 수 있다.

우선순위 = (대기시간 + 실행시간) / 실행시간

</br>

#### Priority Scheduling

선점 & 비선점 스케줄링. 정적/동적으로 우선순위를 부여하여 우선순위가 높은 순서대로 처리한다. 우선 순위가 높은 프로세스를 빠르게 처리할 수 있다는 장점이 있지만 우선 순위가 낮은 프로세스는 무한정 기다리는 Starvation이 발생할 수 있다. 이러한 Starvation 문제는 Aging 기법으로 해결할 수 있다.

> Aging : 프로세스의 대기시간이 증가할 수록 프로세스의 우선순위를 높여주는 방법이다.

</br>

#### Round Robin

선점 스케줄링. 실시간, 시간 공유 시스템을 위해 구현된 스케줄링 알고리즘이다. 알고리즘을 통해 선정된 프로세스가 일정 시간을 할당받아서 수행되고, 부여받은 시간이 끝나면 Context Switch가 발생하여 다른 프로세스가 실행된다. 부여받은 시간 안에 프로세스가 완료하지 못했을 경우 Ready Queue의 가장 끝에 배치되어 다시 할당을 기다린다. 프로세스 응답 시간은 길지만 평균 대기시간이 감소하여 공정성과 실시간성을 이룰 수 있다.

</br>

#### Multilevel-Queue

Ready Queue를 여러개 만들어서 각각에 대해 다른 우선순위와 스케줄링 알고리즘을 사용하는 기법이다. 다양한 기준으로 큐를 나눌 수 있으며 각 큐는 서로 다른 알고리즘을 적용할 수 있다. 이러한 다단계 큐 스케줄링의 한계점은 상위 큐에 프로세스가 계속 있으면 하위 큐에서 기아 현상 (Starvation)이 발생할 수 있다는 점이다. 이 부분을 보완한 것이 Multilevel Feedback Queue 이다. 

> Multilevel Feedback Queue : 다단계 큐에서 프로세스들이 다른 큐로 이동할 수 있게 해주는 스케줄링 방법